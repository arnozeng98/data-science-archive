
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>PostgreSQL &#8212; Arno&#39;s Projects Collection</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'archive/postgresql';</script>
    <link rel="canonical" href="docs.arnozeng.com/archive/postgresql.html" />
    <link rel="icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="MongoDB" href="mongodb.html" />
    <link rel="prev" title="CFG Parsers" href="cfg-parsers.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="Arno's Projects Collection - Home"/>
    <img src="../_static/logo.png" class="logo__image only-dark pst-js-only" alt="Arno's Projects Collection - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Arno’s Projects Collection
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Machine Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="house-prices%28py%29.html">House Prices (Python)</a></li>
<li class="toctree-l1"><a class="reference internal" href="house-prices%28r%29.html">House Prices (R)</a></li>
<li class="toctree-l1"><a class="reference internal" href="coronary-heart-disease-study.html">Coronary Heart Disease Study</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Deep Learning</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="blogs.html">Blogs</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">NLP</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="cfg-parsers.html">CFG Parsers</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Database</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active"><a class="current reference internal" href="#">PostgreSQL</a></li>
<li class="toctree-l1"><a class="reference internal" href="mongodb.html">MongoDB</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Visualization</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="visualization.html">Visualization</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/arnozeng98/data-science-archive" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/arnozeng98/data-science-archive/issues/new?title=Issue%20on%20page%20%2Farchive/postgresql.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/archive/postgresql.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>PostgreSQL</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subqueries-window-functions-ctes">Subqueries, window functions, CTEs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instructions">Instructions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-set-up">Getting set up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-simple-subqueries">Exercise 1: Simple subqueries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">1.5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">1.6</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">1.7</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-correlated-subqueries">Exercise 2: Correlated subqueries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">2.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">2.4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-window-functions-and-ctes">Exercise 3: Window functions and CTEs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">3.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">3.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">3.3</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="postgresql">
<h1>PostgreSQL<a class="headerlink" href="#postgresql" title="Link to this heading">#</a></h1>
<section id="subqueries-window-functions-ctes">
<h2>Subqueries, window functions, CTEs<a class="headerlink" href="#subqueries-window-functions-ctes" title="Link to this heading">#</a></h2>
</section>
<section id="instructions">
<h2>Instructions<a class="headerlink" href="#instructions" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<p>rubric={mechanics:2}</p>
<ul class="simple">
<li><p>Follow the <a class="reference external" href="https://ubc-mds.github.io/resources_pages/general_lab_instructions/">general lab instructions</a></p></li>
<li><p>You submit 3 files to Gradescope (<em><strong>upload it separately, not as a zip file, or folder</strong></em>)</p>
<ul>
<li><p>Fully rendered ipynb notebook,</p></li>
<li><p>HTML of the fully rendered ipynb notebook</p></li>
<li><p>PDF of the fully rendered ipynb notebook</p></li>
</ul>
</li>
<li><p>We don’t have challenging questions in this lab.</p></li>
<li><p>Add a link to your GitHub repository here: <a class="reference external" href="https://github.ubc.ca/mds-2024-25/DSCI_513_lab3_lingsong">https://github.ubc.ca/mds-2024-25/DSCI_513_lab3_lingsong</a></p></li>
</ul>
<blockquote>
<div><p>NOTE: There is no autograding for any of our labs. So, the idea of Gradescope is just to upload the 3 files listed above. You just need to make sure that it is uploaded. You must upload 3 files individually to Gradescope (not in a folder or a zipped folder).</p>
</div></blockquote>
</section>
<section id="getting-set-up">
<h2>Getting set up<a class="headerlink" href="#getting-set-up" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> sql
<span class="o">%</span><span class="k">config</span> SqlMagic.displaylimit = 50

<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">urllib.parse</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;data/credentials.json&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">login</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
<span class="n">username</span> <span class="o">=</span> <span class="n">login</span><span class="p">[</span><span class="s1">&#39;user&#39;</span><span class="p">]</span>
<span class="n">password</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">parse</span><span class="o">.</span><span class="n">quote</span><span class="p">(</span><span class="n">login</span><span class="p">[</span><span class="s1">&#39;password&#39;</span><span class="p">])</span>
<span class="n">host</span> <span class="o">=</span> <span class="n">login</span><span class="p">[</span><span class="s1">&#39;host&#39;</span><span class="p">]</span>
<span class="n">port</span> <span class="o">=</span> <span class="n">login</span><span class="p">[</span><span class="s1">&#39;port&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">username</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;postgres&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">sql</span> postgresql://{username}:{password}@{host}:{port}/world
</pre></div>
</div>
</div>
</div>
</section>
<section id="exercise-1-simple-subqueries">
<h2>Exercise 1: Simple subqueries<a class="headerlink" href="#exercise-1-simple-subqueries" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<section id="id1">
<h3>1.1<a class="headerlink" href="#id1" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Suppose that we are interested in computing how far the life expectancy of each country in the <code class="docutils literal notranslate"><span class="pre">country</span></code> table is from its average value for all countries in the world. This can be expressed as <code class="docutils literal notranslate"><span class="pre">lifeexpectancy</span></code> <span class="math notranslate nohighlight">\(-\)</span> <code class="docutils literal notranslate"><span class="pre">AVG(lifeexpectancy)</span></code>.</p>
<p>Write a query that lists country names and their life expectancy deviation from the world average.</p>
<ul class="simple">
<li><p>Eliminate rows with null values</p></li>
<li><p>Sort your results in ascending order by the values in the life expectancy deviation column</p></li>
<li><p>Round the values in the life expectancy deviation column to 1 decimal digit.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT 
    name AS &quot;Country&quot;,
    ROUND(
        lifeexpectancy::NUMERIC - (
            SELECT AVG(lifeexpectancy)::NUMERIC
            FROM country
            WHERE lifeexpectancy IS NOT NULL
        ), 1) AS &quot;Life Expectancy Deviation&quot;
FROM 
    country
WHERE 
    lifeexpectancy IS NOT NULL
ORDER BY 
    &quot;Life Expectancy Deviation&quot; ASC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
222 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Country</th>
        <th>Life Expectancy Deviation</th>
    </tr>
    <tr>
        <td>Zambia</td>
        <td>-29.3</td>
    </tr>
    <tr>
        <td>Mozambique</td>
        <td>-29.0</td>
    </tr>
    <tr>
        <td>Malawi</td>
        <td>-28.9</td>
    </tr>
    <tr>
        <td>Zimbabwe</td>
        <td>-28.7</td>
    </tr>
    <tr>
        <td>Angola</td>
        <td>-28.2</td>
    </tr>
    <tr>
        <td>Botswana</td>
        <td>-27.2</td>
    </tr>
    <tr>
        <td>Rwanda</td>
        <td>-27.2</td>
    </tr>
    <tr>
        <td>Swaziland</td>
        <td>-26.1</td>
    </tr>
    <tr>
        <td>Niger</td>
        <td>-25.2</td>
    </tr>
    <tr>
        <td>Namibia</td>
        <td>-24.0</td>
    </tr>
    <tr>
        <td>Uganda</td>
        <td>-23.6</td>
    </tr>
    <tr>
        <td>Central African Republic</td>
        <td>-22.5</td>
    </tr>
    <tr>
        <td>Côte dIvoire</td>
        <td>-21.3</td>
    </tr>
    <tr>
        <td>Ethiopia</td>
        <td>-21.3</td>
    </tr>
    <tr>
        <td>Sierra Leone</td>
        <td>-21.2</td>
    </tr>
    <tr>
        <td>Guinea</td>
        <td>-20.9</td>
    </tr>
    <tr>
        <td>Afghanistan</td>
        <td>-20.6</td>
    </tr>
    <tr>
        <td>East Timor</td>
        <td>-20.5</td>
    </tr>
    <tr>
        <td>Somalia</td>
        <td>-20.3</td>
    </tr>
    <tr>
        <td>Burundi</td>
        <td>-20.3</td>
    </tr>
    <tr>
        <td>Burkina Faso</td>
        <td>-19.8</td>
    </tr>
    <tr>
        <td>Mali</td>
        <td>-19.8</td>
    </tr>
    <tr>
        <td>Congo</td>
        <td>-19.1</td>
    </tr>
    <tr>
        <td>Kenya</td>
        <td>-18.5</td>
    </tr>
    <tr>
        <td>Congo, The Democratic Republic of the</td>
        <td>-17.7</td>
    </tr>
    <tr>
        <td>Guinea-Bissau</td>
        <td>-17.5</td>
    </tr>
    <tr>
        <td>Haiti</td>
        <td>-17.3</td>
    </tr>
    <tr>
        <td>Western Sahara</td>
        <td>-16.7</td>
    </tr>
    <tr>
        <td>Gabon</td>
        <td>-16.4</td>
    </tr>
    <tr>
        <td>Benin</td>
        <td>-16.3</td>
    </tr>
    <tr>
        <td>Chad</td>
        <td>-16.0</td>
    </tr>
    <tr>
        <td>Mauritania</td>
        <td>-15.7</td>
    </tr>
    <tr>
        <td>Lesotho</td>
        <td>-15.7</td>
    </tr>
    <tr>
        <td>Djibouti</td>
        <td>-15.7</td>
    </tr>
    <tr>
        <td>Liberia</td>
        <td>-15.5</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>-15.4</td>
    </tr>
    <tr>
        <td>Nigeria</td>
        <td>-14.9</td>
    </tr>
    <tr>
        <td>Tanzania</td>
        <td>-14.2</td>
    </tr>
    <tr>
        <td>Bhutan</td>
        <td>-14.1</td>
    </tr>
    <tr>
        <td>Laos</td>
        <td>-13.4</td>
    </tr>
    <tr>
        <td>Gambia</td>
        <td>-13.3</td>
    </tr>
    <tr>
        <td>Equatorial Guinea</td>
        <td>-12.9</td>
    </tr>
    <tr>
        <td>Togo</td>
        <td>-11.8</td>
    </tr>
    <tr>
        <td>Cameroon</td>
        <td>-11.7</td>
    </tr>
    <tr>
        <td>Myanmar</td>
        <td>-11.6</td>
    </tr>
    <tr>
        <td>Madagascar</td>
        <td>-11.5</td>
    </tr>
    <tr>
        <td>Eritrea</td>
        <td>-10.7</td>
    </tr>
    <tr>
        <td>Cambodia</td>
        <td>-10.0</td>
    </tr>
    <tr>
        <td>Sudan</td>
        <td>-9.9</td>
    </tr>
    <tr>
        <td>Ghana</td>
        <td>-9.1</td>
    </tr>
</table>
<span style="font-style:italic;text-align:center;">222 rows, truncated to displaylimit of 50</span></div></div>
</div>
</section>
<section id="id2">
<h3>1.2<a class="headerlink" href="#id2" title="Link to this heading">#</a></h3>
<p>rubric={reasoning:1}</p>
<p>Explain why you can’t write a query for Exercise <a class="reference internal" href="#1.1"><span class="xref myst">1.1</span></a> without using a subquery.</p>
<p><strong>Answer:</strong> Because SQL does not allow us to directly mix aggregate functions (such as <code class="docutils literal notranslate"><span class="pre">AVG()</span></code>) and row-level calculations in the same query.</p>
</section>
<section id="id3">
<h3>1.3<a class="headerlink" href="#id3" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Use your query in Exercise <a class="reference internal" href="#1.1"><span class="xref myst">1.1</span></a> to return the same columns, but modify it such that only countries are returned whose population density (i.e. <code class="docutils literal notranslate"><span class="pre">population</span> <span class="pre">/</span> <span class="pre">surfacearea</span></code>) is greater than the world average.</p>
<p>On average, do the countries returned by your query have lower or higher life expectancy, compared to the world average? (No computation needed, just look at the results to find out).</p>
<p><em>Type your answer here, replacing this text.</em></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT 
    name AS &quot;Country&quot;,
    ROUND(lifeexpectancy::NUMERIC - (
        SELECT AVG(lifeexpectancy)::NUMERIC
        FROM country
        WHERE lifeexpectancy IS NOT NULL
    ), 1) AS &quot;Life Expectancy Deviation&quot;
FROM 
    country
WHERE
    lifeexpectancy IS NOT NULL
    AND population / surfacearea &gt; (
        SELECT AVG(population / surfacearea)
        FROM country
        WHERE population IS NOT NULL AND surfacearea IS NOT NULL
    )
ORDER BY 
    &quot;Life Expectancy Deviation&quot; ASC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
20 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Country</th>
        <th>Life Expectancy Deviation</th>
    </tr>
    <tr>
        <td>Bangladesh</td>
        <td>-6.3</td>
    </tr>
    <tr>
        <td>Nauru</td>
        <td>-5.7</td>
    </tr>
    <tr>
        <td>Maldives</td>
        <td>-4.3</td>
    </tr>
    <tr>
        <td>Tuvalu</td>
        <td>-0.2</td>
    </tr>
    <tr>
        <td>Mauritius</td>
        <td>4.5</td>
    </tr>
    <tr>
        <td>Palestine</td>
        <td>4.9</td>
    </tr>
    <tr>
        <td>Barbados</td>
        <td>6.5</td>
    </tr>
    <tr>
        <td>Bahrain</td>
        <td>6.5</td>
    </tr>
    <tr>
        <td>South Korea</td>
        <td>7.9</td>
    </tr>
    <tr>
        <td>Puerto Rico</td>
        <td>9.1</td>
    </tr>
    <tr>
        <td>Taiwan</td>
        <td>9.9</td>
    </tr>
    <tr>
        <td>Bermuda</td>
        <td>10.4</td>
    </tr>
    <tr>
        <td>Malta</td>
        <td>11.4</td>
    </tr>
    <tr>
        <td>Aruba</td>
        <td>11.9</td>
    </tr>
    <tr>
        <td>Monaco</td>
        <td>12.3</td>
    </tr>
    <tr>
        <td>Gibraltar</td>
        <td>12.5</td>
    </tr>
    <tr>
        <td>Hong Kong</td>
        <td>13.0</td>
    </tr>
    <tr>
        <td>Singapore</td>
        <td>13.6</td>
    </tr>
    <tr>
        <td>San Marino</td>
        <td>14.6</td>
    </tr>
    <tr>
        <td>Macao</td>
        <td>15.1</td>
    </tr>
</table></div></div>
</div>
</section>
<section id="id4">
<h3>1.4<a class="headerlink" href="#id4" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Write a query that lists all continents and the number of countries in each continent that have a life expectancy greater than 77 years. If there are no countries in a continent that satisfy this condition, the value of the second column should be null.</p>
<p>Your result should look like this if ordered alphabetically by continent:</p>
<img src="img/1_4.png" width="170"><blockquote>
<div><p><strong>Hint:</strong> The result of a subquery is also a table that you can use in a join operation.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT 
    continents.continent,
    CASE 
        WHEN &quot;lifeexpectancy &gt; 77&quot;.count &gt; 0
        THEN &quot;lifeexpectancy &gt; 77&quot;.count
        ELSE NULL
    END AS count
FROM 
    (SELECT DISTINCT continent FROM country) AS continents
LEFT JOIN 
    (
        SELECT 
            continent,
            COUNT(*) AS count
        FROM 
            country
        WHERE 
            lifeexpectancy &gt; 77
        GROUP BY 
            continent
    ) AS &quot;lifeexpectancy &gt; 77&quot;
ON 
    continents.continent = &quot;lifeexpectancy &gt; 77&quot;.continent
ORDER BY 
    continents.continent;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
7 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>continent</th>
        <th>count</th>
    </tr>
    <tr>
        <td>Africa</td>
        <td>None</td>
    </tr>
    <tr>
        <td>Antarctica</td>
        <td>None</td>
    </tr>
    <tr>
        <td>Asia</td>
        <td>6</td>
    </tr>
    <tr>
        <td>Europe</td>
        <td>22</td>
    </tr>
    <tr>
        <td>North America</td>
        <td>8</td>
    </tr>
    <tr>
        <td>Oceania</td>
        <td>3</td>
    </tr>
    <tr>
        <td>South America</td>
        <td>None</td>
    </tr>
</table></div></div>
</div>
</section>
<section id="id5">
<h3>1.5<a class="headerlink" href="#id5" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Retrieve the names of non-European countries in the world where one or more of the official European languages are spoken (either officially or non-officially). Make sure to remove duplicate country names from your results, and sort the rows by country name in descending order.</p>
<p>For this query, I have provided some starter code for you:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT DISTINCT
    c.name AS &quot;Country&quot;
FROM
    country c
JOIN
    countrylanguage cl
ON
    c.code = cl.countrycode
WHERE
    c.continent != &#39;Europe&#39;
    AND
    cl.language IN (
        SELECT DISTINCT
            cl.language
        FROM
            country c
        JOIN
            countrylanguage cl
        ON
            c.code = cl.countrycode
        WHERE
            c.continent = &#39;Europe&#39;
    )
ORDER BY
    &quot;Country&quot; DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
120 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Country</th>
    </tr>
    <tr>
        <td>Zimbabwe</td>
    </tr>
    <tr>
        <td>Yemen</td>
    </tr>
    <tr>
        <td>Western Sahara</td>
    </tr>
    <tr>
        <td>Virgin Islands, U.S.</td>
    </tr>
    <tr>
        <td>Virgin Islands, British</td>
    </tr>
    <tr>
        <td>Venezuela</td>
    </tr>
    <tr>
        <td>Vanuatu</td>
    </tr>
    <tr>
        <td>Uzbekistan</td>
    </tr>
    <tr>
        <td>Uruguay</td>
    </tr>
    <tr>
        <td>United States Minor Outlying Islands</td>
    </tr>
    <tr>
        <td>United States</td>
    </tr>
    <tr>
        <td>United Arab Emirates</td>
    </tr>
    <tr>
        <td>Tuvalu</td>
    </tr>
    <tr>
        <td>Turks and Caicos Islands</td>
    </tr>
    <tr>
        <td>Turkmenistan</td>
    </tr>
    <tr>
        <td>Turkey</td>
    </tr>
    <tr>
        <td>Tunisia</td>
    </tr>
    <tr>
        <td>Trinidad and Tobago</td>
    </tr>
    <tr>
        <td>Tonga</td>
    </tr>
    <tr>
        <td>Tokelau</td>
    </tr>
    <tr>
        <td>Tajikistan</td>
    </tr>
    <tr>
        <td>Syria</td>
    </tr>
    <tr>
        <td>Sudan</td>
    </tr>
    <tr>
        <td>South Africa</td>
    </tr>
    <tr>
        <td>Somalia</td>
    </tr>
    <tr>
        <td>Seychelles</td>
    </tr>
    <tr>
        <td>Saudi Arabia</td>
    </tr>
    <tr>
        <td>Sao Tome and Principe</td>
    </tr>
    <tr>
        <td>Samoa</td>
    </tr>
    <tr>
        <td>Saint Vincent and the Grenadines</td>
    </tr>
    <tr>
        <td>Saint Pierre and Miquelon</td>
    </tr>
    <tr>
        <td>Saint Lucia</td>
    </tr>
    <tr>
        <td>Saint Kitts and Nevis</td>
    </tr>
    <tr>
        <td>Saint Helena</td>
    </tr>
    <tr>
        <td>Rwanda</td>
    </tr>
    <tr>
        <td>Qatar</td>
    </tr>
    <tr>
        <td>Puerto Rico</td>
    </tr>
    <tr>
        <td>Peru</td>
    </tr>
    <tr>
        <td>Paraguay</td>
    </tr>
    <tr>
        <td>Panama</td>
    </tr>
    <tr>
        <td>Palestine</td>
    </tr>
    <tr>
        <td>Palau</td>
    </tr>
    <tr>
        <td>Oman</td>
    </tr>
    <tr>
        <td>Northern Mariana Islands</td>
    </tr>
    <tr>
        <td>Norfolk Island</td>
    </tr>
    <tr>
        <td>Niue</td>
    </tr>
    <tr>
        <td>Nicaragua</td>
    </tr>
    <tr>
        <td>New Zealand</td>
    </tr>
    <tr>
        <td>New Caledonia</td>
    </tr>
    <tr>
        <td>Netherlands Antilles</td>
    </tr>
</table>
<span style="font-style:italic;text-align:center;">120 rows, truncated to displaylimit of 50</span></div></div>
</div>
</section>
<section id="id6">
<h3>1.6<a class="headerlink" href="#id6" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Rewrite the following query using a subquery instead of a join:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">country</span><span class="w"> </span><span class="k">c</span>
<span class="k">JOIN</span>
<span class="w">    </span><span class="n">city</span><span class="w"> </span><span class="n">ci</span>
<span class="k">ON</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">capital</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">ci</span><span class="p">.</span><span class="n">id</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="n">ci</span><span class="p">.</span><span class="n">population</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mi">5000000</span>
<span class="p">;</span>
</pre></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT name
FROM country
WHERE
    capital IN (
        SELECT id
        FROM city
        WHERE population &gt; 5000000
    );
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
13 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>name</th>
    </tr>
    <tr>
        <td>United Kingdom</td>
    </tr>
    <tr>
        <td>Egypt</td>
    </tr>
    <tr>
        <td>Indonesia</td>
    </tr>
    <tr>
        <td>Iran</td>
    </tr>
    <tr>
        <td>Japan</td>
    </tr>
    <tr>
        <td>China</td>
    </tr>
    <tr>
        <td>Colombia</td>
    </tr>
    <tr>
        <td>Congo, The Democratic Republic of the</td>
    </tr>
    <tr>
        <td>South Korea</td>
    </tr>
    <tr>
        <td>Mexico</td>
    </tr>
    <tr>
        <td>Peru</td>
    </tr>
    <tr>
        <td>Thailand</td>
    </tr>
    <tr>
        <td>Russian Federation</td>
    </tr>
</table></div></div>
</div>
</section>
<section id="id7">
<h3>1.7<a class="headerlink" href="#id7" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Which countries in the world are vast enough that all western European and Nordic countries could fit within them?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT 
    name AS &quot;Country&quot;,
    surfacearea AS &quot;Surface Area&quot;
FROM
    country
WHERE
    surfacearea &gt; (
        SELECT SUM(surfacearea)
        FROM country
        WHERE region IN (&#39;Western Europe&#39;, &#39;Nordic Countries&#39;)
    )
ORDER BY
    surfacearea DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
11 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Country</th>
        <th>Surface Area</th>
    </tr>
    <tr>
        <td>Russian Federation</td>
        <td>17075400.0</td>
    </tr>
    <tr>
        <td>Antarctica</td>
        <td>13120000.0</td>
    </tr>
    <tr>
        <td>Canada</td>
        <td>9970610.0</td>
    </tr>
    <tr>
        <td>China</td>
        <td>9572900.0</td>
    </tr>
    <tr>
        <td>United States</td>
        <td>9363520.0</td>
    </tr>
    <tr>
        <td>Brazil</td>
        <td>8547403.0</td>
    </tr>
    <tr>
        <td>Australia</td>
        <td>7741220.0</td>
    </tr>
    <tr>
        <td>India</td>
        <td>3287263.0</td>
    </tr>
    <tr>
        <td>Argentina</td>
        <td>2780400.0</td>
    </tr>
    <tr>
        <td>Kazakstan</td>
        <td>2724900.0</td>
    </tr>
    <tr>
        <td>Sudan</td>
        <td>2505813.0</td>
    </tr>
</table></div></div>
</div>
</section>
</section>
<section id="exercise-2-correlated-subqueries">
<h2>Exercise 2: Correlated subqueries<a class="headerlink" href="#exercise-2-correlated-subqueries" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<section id="id8">
<h3>2.1<a class="headerlink" href="#id8" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:3}</p>
<p>Find the number of countries in each continent whose life expectancy is greater than the average value for their respective continent.</p>
<blockquote>
<div><p><strong>Hint:</strong> The <code class="docutils literal notranslate"><span class="pre">lifeexpectancy</span></code> column contains a bunch of nulls. Be careful with your counting!</p>
</div></blockquote>
<blockquote>
<div><p>“Antarctica” won’t be there in the final result.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT
    continent AS &quot;Continent&quot;,
    COUNT(*) AS &quot;Number of Countries have Life Expectancy Above Average&quot;
FROM
    country
WHERE
    lifeexpectancy IS NOT NULL
    AND lifeexpectancy &gt; (
        SELECT AVG(lifeexpectancy)
        FROM country AS subquery
        WHERE lifeexpectancy IS NOT NULL
        AND subquery.continent = country.continent
    )
GROUP BY
    &quot;Continent&quot;
ORDER BY
    &quot;Number of Countries have Life Expectancy Above Average&quot; DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
6 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Continent</th>
        <th>Number of Countries have Life Expectancy Above Average</th>
    </tr>
    <tr>
        <td>Asia</td>
        <td>29</td>
    </tr>
    <tr>
        <td>Europe</td>
        <td>25</td>
    </tr>
    <tr>
        <td>Africa</td>
        <td>22</td>
    </tr>
    <tr>
        <td>North America</td>
        <td>22</td>
    </tr>
    <tr>
        <td>Oceania</td>
        <td>9</td>
    </tr>
    <tr>
        <td>South America</td>
        <td>8</td>
    </tr>
</table></div></div>
</div>
</section>
<section id="id9">
<h3>2.2<a class="headerlink" href="#id9" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>The results of your query for the previous question may not be very informative on first look, because absolute counts do not reveal much unless we can relate them to the total number of countries in each continent.</p>
<p>Borrow your query from Exercise <a class="reference internal" href="#2.2"><span class="xref myst">2.1</span></a> and modify it such that it shows the ratio of the number of countries in each continent whose life expectancy is greater than their continent-average values, to the total number of countries in each continent. Round your ratio values to 2 decimal digits.</p>
<blockquote>
<div><p><strong>Hint:</strong> Again, be careful with your counting, since <code class="docutils literal notranslate"><span class="pre">lifeexpectancy</span></code> column contains a bunch of nulls, and we don’t want to include NULLS.</p>
</div></blockquote>
<blockquote>
<div><p><strong>Hint:</strong> That’s right, you need to add one more subquery somewhere in your previous query!</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT
    continent AS &quot;Continent&quot;,
    ROUND(
        COUNT(*)::NUMERIC / (
            SELECT COUNT(*)::NUMERIC
            FROM country AS subquery_total
            WHERE subquery_total.continent = country.continent
            AND lifeexpectancy IS NOT NULL
        ), 2) AS &quot;Ratio of Countries Above Average&quot;
FROM
    country
WHERE
    lifeexpectancy IS NOT NULL
    AND lifeexpectancy &gt; (
        SELECT AVG(lifeexpectancy)
        FROM country AS subquery_avg
        WHERE subquery_avg.continent = country.continent
        AND lifeexpectancy IS NOT NULL
    )
GROUP BY
    continent
ORDER BY
    &quot;Ratio of Countries Above Average&quot; DESC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
6 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Continent</th>
        <th>Ratio of Countries Above Average</th>
    </tr>
    <tr>
        <td>South America</td>
        <td>0.62</td>
    </tr>
    <tr>
        <td>North America</td>
        <td>0.59</td>
    </tr>
    <tr>
        <td>Asia</td>
        <td>0.57</td>
    </tr>
    <tr>
        <td>Europe</td>
        <td>0.57</td>
    </tr>
    <tr>
        <td>Oceania</td>
        <td>0.45</td>
    </tr>
    <tr>
        <td>Africa</td>
        <td>0.39</td>
    </tr>
</table></div></div>
</div>
</section>
<section id="id10">
<h3>2.3<a class="headerlink" href="#id10" title="Link to this heading">#</a></h3>
<p>rubric={reasoning:2}</p>
<p>Consider this question:</p>
<p>In which European countries English is <strong>not</strong> spoken at all (i.e. not listed in the <code class="docutils literal notranslate"><span class="pre">countrylanguage</span></code> table)?</p>
<p>I have written the following SQL query to answer the above question:</p>
<div class="highlight-sql notranslate"><div class="highlight"><pre><span></span><span class="k">SELECT</span>
<span class="w">    </span><span class="k">DISTINCT</span><span class="w"> </span><span class="k">c</span><span class="p">.</span><span class="n">name</span>
<span class="k">FROM</span>
<span class="w">    </span><span class="n">country</span><span class="w"> </span><span class="k">c</span>
<span class="k">JOIN</span>
<span class="w">    </span><span class="n">countrylanguage</span><span class="w"> </span><span class="n">cl</span>
<span class="k">ON</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">code</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cl</span><span class="p">.</span><span class="n">countrycode</span>
<span class="k">WHERE</span>
<span class="w">    </span><span class="k">NOT</span><span class="w"> </span><span class="n">cl</span><span class="p">.</span><span class="k">language</span><span class="w"> </span><span class="k">ILIKE</span><span class="w"> </span><span class="s1">&#39;english&#39;</span>
<span class="w">    </span><span class="k">AND</span>
<span class="w">    </span><span class="k">c</span><span class="p">.</span><span class="n">continent</span><span class="w"> </span><span class="k">ILIKE</span><span class="w"> </span><span class="s1">&#39;europe&#39;</span>
<span class="p">;</span>
</pre></div>
</div>
<p>However, when I run the above query I can find “United Kingdom” listed in the results, which is clearly incorrect. Can you tell me why I’m getting wrong results?</p>
<p><strong>Answer:</strong></p>
<p>The problem lies in the query logic. <code class="docutils literal notranslate"><span class="pre">NOT</span> <span class="pre">cl.language</span> <span class="pre">ILIKE</span> <span class="pre">'english'</span></code> only filters records of a single language, but does not exclude the entire country. If a country has multiple languages, languages ​​other than “English” will still appear in the results, such as the United Kingdom. The correct approach is to use a subquery to find all the country codes that speak “English”, and then exclude these countries in the main query to ensure that the results do not include any countries that speak “English”.</p>
</section>
<section id="id11">
<h3>2.4<a class="headerlink" href="#id11" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Alright, let’s figure out how to correctly answer the following question from Exercise <a class="reference internal" href="#2.3"><span class="xref myst">2.3</span></a>:</p>
<p>In which European countries English is <strong>not</strong> spoken at all (i.e. not listed in the <code class="docutils literal notranslate"><span class="pre">countrylanguage</span></code> table)?</p>
<p><strong>Note:</strong> There’s more than one way to answer the above question using a query. Here, I want you to use a correlated subquery.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT
    c.name AS &quot;Country&quot;
FROM
    country c
WHERE
    c.continent ILIKE &#39;europe&#39;
    AND NOT EXISTS (
        SELECT 1
        FROM countrylanguage cl
        WHERE cl.countrycode = c.code
        AND cl.language ILIKE &#39;english&#39;
    );
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
38 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Country</th>
    </tr>
    <tr>
        <td>Switzerland</td>
    </tr>
    <tr>
        <td>France</td>
    </tr>
    <tr>
        <td>Luxembourg</td>
    </tr>
    <tr>
        <td>Czech Republic</td>
    </tr>
    <tr>
        <td>Holy See (Vatican City State)</td>
    </tr>
    <tr>
        <td>Moldova</td>
    </tr>
    <tr>
        <td>Ukraine</td>
    </tr>
    <tr>
        <td>Faroe Islands</td>
    </tr>
    <tr>
        <td>Svalbard and Jan Mayen</td>
    </tr>
    <tr>
        <td>Andorra</td>
    </tr>
    <tr>
        <td>Liechtenstein</td>
    </tr>
    <tr>
        <td>Croatia</td>
    </tr>
    <tr>
        <td>Netherlands</td>
    </tr>
    <tr>
        <td>Hungary</td>
    </tr>
    <tr>
        <td>Portugal</td>
    </tr>
    <tr>
        <td>Greece</td>
    </tr>
    <tr>
        <td>Belarus</td>
    </tr>
    <tr>
        <td>Lithuania</td>
    </tr>
    <tr>
        <td>Spain</td>
    </tr>
    <tr>
        <td>Bosnia and Herzegovina</td>
    </tr>
    <tr>
        <td>Germany</td>
    </tr>
    <tr>
        <td>Bulgaria</td>
    </tr>
    <tr>
        <td>Austria</td>
    </tr>
    <tr>
        <td>Latvia</td>
    </tr>
    <tr>
        <td>Italy</td>
    </tr>
    <tr>
        <td>Romania</td>
    </tr>
    <tr>
        <td>Macedonia</td>
    </tr>
    <tr>
        <td>Estonia</td>
    </tr>
    <tr>
        <td>Poland</td>
    </tr>
    <tr>
        <td>Russian Federation</td>
    </tr>
    <tr>
        <td>Finland</td>
    </tr>
    <tr>
        <td>San Marino</td>
    </tr>
    <tr>
        <td>Slovakia</td>
    </tr>
    <tr>
        <td>Slovenia</td>
    </tr>
    <tr>
        <td>Albania</td>
    </tr>
    <tr>
        <td>Belgium</td>
    </tr>
    <tr>
        <td>Yugoslavia</td>
    </tr>
    <tr>
        <td>Sweden</td>
    </tr>
</table></div></div>
</div>
</section>
</section>
<section id="exercise-3-window-functions-and-ctes">
<h2>Exercise 3: Window functions and CTEs<a class="headerlink" href="#exercise-3-window-functions-and-ctes" title="Link to this heading">#</a></h2>
<hr class="docutils" />
<section id="id12">
<h3>3.1<a class="headerlink" href="#id12" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:1}</p>
<p>Rewrite the query that you’ve written for Exercise <a class="reference internal" href="#1.1"><span class="xref myst">1.1</span></a> using window functions this time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT 
    name AS &quot;Country&quot;,
    ROUND(
        lifeexpectancy::NUMERIC - AVG(lifeexpectancy) OVER ()::NUMERIC, 1
    ) AS &quot;Life Expectancy Deviation&quot;
FROM 
    country
WHERE 
    lifeexpectancy IS NOT NULL
ORDER BY 
    &quot;Life Expectancy Deviation&quot; ASC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
222 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>Country</th>
        <th>Life Expectancy Deviation</th>
    </tr>
    <tr>
        <td>Zambia</td>
        <td>-29.3</td>
    </tr>
    <tr>
        <td>Mozambique</td>
        <td>-29.0</td>
    </tr>
    <tr>
        <td>Malawi</td>
        <td>-28.9</td>
    </tr>
    <tr>
        <td>Zimbabwe</td>
        <td>-28.7</td>
    </tr>
    <tr>
        <td>Angola</td>
        <td>-28.2</td>
    </tr>
    <tr>
        <td>Botswana</td>
        <td>-27.2</td>
    </tr>
    <tr>
        <td>Rwanda</td>
        <td>-27.2</td>
    </tr>
    <tr>
        <td>Swaziland</td>
        <td>-26.1</td>
    </tr>
    <tr>
        <td>Niger</td>
        <td>-25.2</td>
    </tr>
    <tr>
        <td>Namibia</td>
        <td>-24.0</td>
    </tr>
    <tr>
        <td>Uganda</td>
        <td>-23.6</td>
    </tr>
    <tr>
        <td>Central African Republic</td>
        <td>-22.5</td>
    </tr>
    <tr>
        <td>Côte dIvoire</td>
        <td>-21.3</td>
    </tr>
    <tr>
        <td>Ethiopia</td>
        <td>-21.3</td>
    </tr>
    <tr>
        <td>Sierra Leone</td>
        <td>-21.2</td>
    </tr>
    <tr>
        <td>Guinea</td>
        <td>-20.9</td>
    </tr>
    <tr>
        <td>Afghanistan</td>
        <td>-20.6</td>
    </tr>
    <tr>
        <td>East Timor</td>
        <td>-20.5</td>
    </tr>
    <tr>
        <td>Somalia</td>
        <td>-20.3</td>
    </tr>
    <tr>
        <td>Burundi</td>
        <td>-20.3</td>
    </tr>
    <tr>
        <td>Burkina Faso</td>
        <td>-19.8</td>
    </tr>
    <tr>
        <td>Mali</td>
        <td>-19.8</td>
    </tr>
    <tr>
        <td>Congo</td>
        <td>-19.1</td>
    </tr>
    <tr>
        <td>Kenya</td>
        <td>-18.5</td>
    </tr>
    <tr>
        <td>Congo, The Democratic Republic of the</td>
        <td>-17.7</td>
    </tr>
    <tr>
        <td>Guinea-Bissau</td>
        <td>-17.5</td>
    </tr>
    <tr>
        <td>Haiti</td>
        <td>-17.3</td>
    </tr>
    <tr>
        <td>Western Sahara</td>
        <td>-16.7</td>
    </tr>
    <tr>
        <td>Gabon</td>
        <td>-16.4</td>
    </tr>
    <tr>
        <td>Benin</td>
        <td>-16.3</td>
    </tr>
    <tr>
        <td>Chad</td>
        <td>-16.0</td>
    </tr>
    <tr>
        <td>Mauritania</td>
        <td>-15.7</td>
    </tr>
    <tr>
        <td>Lesotho</td>
        <td>-15.7</td>
    </tr>
    <tr>
        <td>Djibouti</td>
        <td>-15.7</td>
    </tr>
    <tr>
        <td>Liberia</td>
        <td>-15.5</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>-15.4</td>
    </tr>
    <tr>
        <td>Nigeria</td>
        <td>-14.9</td>
    </tr>
    <tr>
        <td>Tanzania</td>
        <td>-14.2</td>
    </tr>
    <tr>
        <td>Bhutan</td>
        <td>-14.1</td>
    </tr>
    <tr>
        <td>Laos</td>
        <td>-13.4</td>
    </tr>
    <tr>
        <td>Gambia</td>
        <td>-13.3</td>
    </tr>
    <tr>
        <td>Equatorial Guinea</td>
        <td>-12.9</td>
    </tr>
    <tr>
        <td>Togo</td>
        <td>-11.8</td>
    </tr>
    <tr>
        <td>Cameroon</td>
        <td>-11.7</td>
    </tr>
    <tr>
        <td>Myanmar</td>
        <td>-11.6</td>
    </tr>
    <tr>
        <td>Madagascar</td>
        <td>-11.5</td>
    </tr>
    <tr>
        <td>Eritrea</td>
        <td>-10.7</td>
    </tr>
    <tr>
        <td>Cambodia</td>
        <td>-10.0</td>
    </tr>
    <tr>
        <td>Sudan</td>
        <td>-9.9</td>
    </tr>
    <tr>
        <td>Ghana</td>
        <td>-9.1</td>
    </tr>
</table>
<span style="font-style:italic;text-align:center;">222 rows, truncated to displaylimit of 50</span></div></div>
</div>
</section>
<section id="id13">
<h3>3.2<a class="headerlink" href="#id13" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Write a query that returns country, continent and city names, as well as the ratio of the population of each city to the population of the country where it’s located, expressed as a percentage value. Furthermore, your query should also return the population rank of each city among all other cities in the same continent in descending order.</p>
<p>Your results should look like this:</p>
<img src="img/3_2.png" width="700">
<p>Use the above image to name and format your columns properly.</p>
<blockquote>
<div><p><strong>Note:</strong> The order of your returned rows might be different from mine, but that is fine.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

SELECT 
    c.name AS country,
    c.continent,
    ci.name AS city,
    ROUND((ci.population::NUMERIC / c.population) * 100, 2) || &#39;%&#39; AS city_pop_ratio,
    RANK() OVER (PARTITION BY c.continent ORDER BY ci.population DESC) AS rank_in_continent
FROM 
    country c
JOIN 
    city ci
ON 
    c.code = ci.countrycode
WHERE 
    c.population IS NOT NULL AND ci.population IS NOT NULL
ORDER BY 
    c.continent, rank_in_continent ASC;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
4079 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>country</th>
        <th>continent</th>
        <th>city</th>
        <th>city_pop_ratio</th>
        <th>rank_in_continent</th>
    </tr>
    <tr>
        <td>Egypt</td>
        <td>Africa</td>
        <td>Cairo</td>
        <td>9.92%</td>
        <td>1</td>
    </tr>
    <tr>
        <td>Congo, The Democratic Republic of the</td>
        <td>Africa</td>
        <td>Kinshasa</td>
        <td>9.80%</td>
        <td>2</td>
    </tr>
    <tr>
        <td>Egypt</td>
        <td>Africa</td>
        <td>Alexandria</td>
        <td>4.86%</td>
        <td>3</td>
    </tr>
    <tr>
        <td>Morocco</td>
        <td>Africa</td>
        <td>Casablanca</td>
        <td>10.37%</td>
        <td>4</td>
    </tr>
    <tr>
        <td>Côte dIvoire</td>
        <td>Africa</td>
        <td>Abidjan</td>
        <td>16.91%</td>
        <td>5</td>
    </tr>
    <tr>
        <td>Ethiopia</td>
        <td>Africa</td>
        <td>Addis Abeba</td>
        <td>3.99%</td>
        <td>6</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>Africa</td>
        <td>Cape Town</td>
        <td>5.83%</td>
        <td>7</td>
    </tr>
    <tr>
        <td>Kenya</td>
        <td>Africa</td>
        <td>Nairobi</td>
        <td>7.61%</td>
        <td>8</td>
    </tr>
    <tr>
        <td>Egypt</td>
        <td>Africa</td>
        <td>Giza</td>
        <td>3.25%</td>
        <td>9</td>
    </tr>
    <tr>
        <td>Algeria</td>
        <td>Africa</td>
        <td>Alger</td>
        <td>6.89%</td>
        <td>10</td>
    </tr>
    <tr>
        <td>Angola</td>
        <td>Africa</td>
        <td>Luanda</td>
        <td>15.70%</td>
        <td>11</td>
    </tr>
    <tr>
        <td>Tanzania</td>
        <td>Africa</td>
        <td>Dar es Salaam</td>
        <td>5.21%</td>
        <td>12</td>
    </tr>
    <tr>
        <td>Libyan Arab Jamahiriya</td>
        <td>Africa</td>
        <td>Tripoli</td>
        <td>30.01%</td>
        <td>13</td>
    </tr>
    <tr>
        <td>Nigeria</td>
        <td>Africa</td>
        <td>Lagos</td>
        <td>1.36%</td>
        <td>14</td>
    </tr>
    <tr>
        <td>Cameroon</td>
        <td>Africa</td>
        <td>Douala</td>
        <td>9.60%</td>
        <td>15</td>
    </tr>
    <tr>
        <td>Nigeria</td>
        <td>Africa</td>
        <td>Ibadan</td>
        <td>1.28%</td>
        <td>16</td>
    </tr>
    <tr>
        <td>Zimbabwe</td>
        <td>Africa</td>
        <td>Harare</td>
        <td>12.08%</td>
        <td>17</td>
    </tr>
    <tr>
        <td>Cameroon</td>
        <td>Africa</td>
        <td>Yaoundé</td>
        <td>9.10%</td>
        <td>18</td>
    </tr>
    <tr>
        <td>Zambia</td>
        <td>Africa</td>
        <td>Lusaka</td>
        <td>14.36%</td>
        <td>19</td>
    </tr>
    <tr>
        <td>Sudan</td>
        <td>Africa</td>
        <td>Omdurman</td>
        <td>4.31%</td>
        <td>20</td>
    </tr>
    <tr>
        <td>Guinea</td>
        <td>Africa</td>
        <td>Conakry</td>
        <td>14.68%</td>
        <td>21</td>
    </tr>
    <tr>
        <td>Ghana</td>
        <td>Africa</td>
        <td>Accra</td>
        <td>5.29%</td>
        <td>22</td>
    </tr>
    <tr>
        <td>Mozambique</td>
        <td>Africa</td>
        <td>Maputo</td>
        <td>5.18%</td>
        <td>23</td>
    </tr>
    <tr>
        <td>Somalia</td>
        <td>Africa</td>
        <td>Mogadishu</td>
        <td>9.87%</td>
        <td>24</td>
    </tr>
    <tr>
        <td>Congo</td>
        <td>Africa</td>
        <td>Brazzaville</td>
        <td>32.28%</td>
        <td>25</td>
    </tr>
    <tr>
        <td>Sudan</td>
        <td>Africa</td>
        <td>Khartum</td>
        <td>3.21%</td>
        <td>26</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>Africa</td>
        <td>Soweto</td>
        <td>2.24%</td>
        <td>27</td>
    </tr>
    <tr>
        <td>Uganda</td>
        <td>Africa</td>
        <td>Kampala</td>
        <td>4.09%</td>
        <td>28</td>
    </tr>
    <tr>
        <td>Egypt</td>
        <td>Africa</td>
        <td>Shubra al-Khayma</td>
        <td>1.27%</td>
        <td>29</td>
    </tr>
    <tr>
        <td>Senegal</td>
        <td>Africa</td>
        <td>Pikine</td>
        <td>9.02%</td>
        <td>30</td>
    </tr>
    <tr>
        <td>Congo, The Democratic Republic of the</td>
        <td>Africa</td>
        <td>Lubumbashi</td>
        <td>1.65%</td>
        <td>31</td>
    </tr>
    <tr>
        <td>Liberia</td>
        <td>Africa</td>
        <td>Monrovia</td>
        <td>26.95%</td>
        <td>32</td>
    </tr>
    <tr>
        <td>Sierra Leone</td>
        <td>Africa</td>
        <td>Freetown</td>
        <td>17.51%</td>
        <td>32</td>
    </tr>
    <tr>
        <td>Burkina Faso</td>
        <td>Africa</td>
        <td>Ouagadougou</td>
        <td>6.90%</td>
        <td>34</td>
    </tr>
    <tr>
        <td>Mali</td>
        <td>Africa</td>
        <td>Bamako</td>
        <td>7.21%</td>
        <td>35</td>
    </tr>
    <tr>
        <td>Congo, The Democratic Republic of the</td>
        <td>Africa</td>
        <td>Mbuji-Mayi</td>
        <td>1.56%</td>
        <td>36</td>
    </tr>
    <tr>
        <td>Libyan Arab Jamahiriya</td>
        <td>Africa</td>
        <td>Bengasi</td>
        <td>14.34%</td>
        <td>37</td>
    </tr>
    <tr>
        <td>Senegal</td>
        <td>Africa</td>
        <td>Dakar</td>
        <td>8.28%</td>
        <td>38</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>Africa</td>
        <td>Johannesburg</td>
        <td>1.87%</td>
        <td>39</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>Africa</td>
        <td>Port Elizabeth</td>
        <td>1.86%</td>
        <td>40</td>
    </tr>
    <tr>
        <td>Nigeria</td>
        <td>Africa</td>
        <td>Ogbomosho</td>
        <td>0.65%</td>
        <td>41</td>
    </tr>
    <tr>
        <td>Sudan</td>
        <td>Africa</td>
        <td>Sharq al-Nil</td>
        <td>2.38%</td>
        <td>42</td>
    </tr>
    <tr>
        <td>Tunisia</td>
        <td>Africa</td>
        <td>Tunis</td>
        <td>7.20%</td>
        <td>43</td>
    </tr>
    <tr>
        <td>Madagascar</td>
        <td>Africa</td>
        <td>Antananarivo</td>
        <td>4.24%</td>
        <td>44</td>
    </tr>
    <tr>
        <td>Nigeria</td>
        <td>Africa</td>
        <td>Kano</td>
        <td>0.60%</td>
        <td>45</td>
    </tr>
    <tr>
        <td>Mauritania</td>
        <td>Africa</td>
        <td>Nouakchott</td>
        <td>24.99%</td>
        <td>46</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>Africa</td>
        <td>Pretoria</td>
        <td>1.63%</td>
        <td>47</td>
    </tr>
    <tr>
        <td>South Africa</td>
        <td>Africa</td>
        <td>Inanda</td>
        <td>1.57%</td>
        <td>48</td>
    </tr>
    <tr>
        <td>Morocco</td>
        <td>Africa</td>
        <td>Rabat</td>
        <td>2.20%</td>
        <td>49</td>
    </tr>
    <tr>
        <td>Morocco</td>
        <td>Africa</td>
        <td>Marrakech</td>
        <td>2.19%</td>
        <td>50</td>
    </tr>
</table>
<span style="font-style:italic;text-align:center;">4079 rows, truncated to displaylimit of 50</span></div></div>
</div>
</section>
<section id="id14">
<h3>3.3<a class="headerlink" href="#id14" title="Link to this heading">#</a></h3>
<p>rubric={accuracy:2}</p>
<p>Suppose that we’d like to only choose the most populated city in each continent. The problem is, it’s not possible to use a window function in the <code class="docutils literal notranslate"><span class="pre">WHERE</span></code> clause. But don’t worry, it’s not the end of the world!</p>
<p>Using your query in Exercise <a class="reference internal" href="#3.2"><span class="xref myst">3.2</span></a>, write a common table expression (CTE) to retrieve rows associated with the most populated cities of each continent. In each row, your query should only return the city name, along with the name of the country and continent where it’s located.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%%</span><span class="k">sql</span>

WITH RankedCities AS (
    SELECT 
        c.name AS country,
        c.continent,
        ci.name AS city,
        ci.population,
        RANK() OVER (PARTITION BY c.continent ORDER BY ci.population DESC) AS rank_in_continent
    FROM 
        country c
    JOIN 
        city ci
    ON 
        c.code = ci.countrycode
    WHERE 
        c.population IS NOT NULL AND ci.population IS NOT NULL
)
SELECT 
    country, continent, city
FROM 
    RankedCities
WHERE 
    rank_in_continent = 1
ORDER BY 
    continent;
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> * postgresql://postgres:***@localhost:5432/world
6 rows affected.
</pre></div>
</div>
<div class="output text_html"><table>
    <tr>
        <th>country</th>
        <th>continent</th>
        <th>city</th>
    </tr>
    <tr>
        <td>Egypt</td>
        <td>Africa</td>
        <td>Cairo</td>
    </tr>
    <tr>
        <td>India</td>
        <td>Asia</td>
        <td>Mumbai (Bombay)</td>
    </tr>
    <tr>
        <td>Russian Federation</td>
        <td>Europe</td>
        <td>Moscow</td>
    </tr>
    <tr>
        <td>Mexico</td>
        <td>North America</td>
        <td>Ciudad de México</td>
    </tr>
    <tr>
        <td>Australia</td>
        <td>Oceania</td>
        <td>Sydney</td>
    </tr>
    <tr>
        <td>Brazil</td>
        <td>South America</td>
        <td>São Paulo</td>
    </tr>
</table></div></div>
</div>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./archive"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="cfg-parsers.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">CFG Parsers</p>
      </div>
    </a>
    <a class="right-next"
       href="mongodb.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">MongoDB</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#subqueries-window-functions-ctes">Subqueries, window functions, CTEs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#instructions">Instructions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#getting-set-up">Getting set up</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-1-simple-subqueries">Exercise 1: Simple subqueries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id3">1.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id4">1.4</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id5">1.5</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id6">1.6</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id7">1.7</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-2-correlated-subqueries">Exercise 2: Correlated subqueries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id8">2.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id9">2.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id10">2.3</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id11">2.4</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-3-window-functions-and-ctes">Exercise 3: Window functions and CTEs</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id12">3.1</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id13">3.2</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#id14">3.3</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Arno Zeng
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2025.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>